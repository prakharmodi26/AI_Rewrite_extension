{
  "version": 3,
  "sources": ["../../extension/src/storage.ts", "../../extension/src/options.ts"],
  "sourcesContent": ["import { Settings, Tone } from './types.js';\n\nconst DEFAULTS = {\n  serverUrl: 'http://localhost:8080',\n  defaultTone: 'clear' as Tone,\n  redact: false,\n};\n\nasync function ensureInstallId(): Promise<string> {\n  const { installId } = await chrome.storage.local.get('installId');\n  if (installId && typeof installId === 'string') return installId;\n  const id = crypto.randomUUID();\n  await chrome.storage.local.set({ installId: id });\n  return id;\n}\n\nexport async function getSettings(): Promise<Settings> {\n  const sync = await chrome.storage.sync.get(['serverUrl', 'defaultTone', 'redact']);\n  const local = await chrome.storage.local.get(['secret', 'installId']);\n  const installId = local.installId || (await ensureInstallId());\n  return {\n    serverUrl: sync.serverUrl || DEFAULTS.serverUrl,\n    defaultTone: (sync.defaultTone as Tone) || DEFAULTS.defaultTone,\n    redact: typeof sync.redact === 'boolean' ? sync.redact : DEFAULTS.redact,\n    secret: typeof local.secret === 'string' ? local.secret : undefined,\n    installId,\n  };\n}\n\nexport async function setSyncSettings(partial: Partial<Pick<Settings, 'serverUrl' | 'defaultTone' | 'redact'>>): Promise<void> {\n  await chrome.storage.sync.set(partial);\n}\n\nexport async function setLocalSettings(partial: Partial<Pick<Settings, 'secret' | 'installId'>>): Promise<void> {\n  await chrome.storage.local.set(partial);\n}\n\nexport async function regenerateInstallId(): Promise<string> {\n  const id = crypto.randomUUID();\n  await chrome.storage.local.set({ installId: id });\n  return id;\n}\n", "import { getSettings, regenerateInstallId, setLocalSettings, setSyncSettings } from './storage.js';\n\nfunction isValidUrl(value: string): boolean {\n  try {\n    const u = new URL(value);\n    return u.protocol === 'http:' || u.protocol === 'https:';\n  } catch {\n    return false;\n  }\n}\n\nasync function init() {\n  const serverUrl = document.getElementById('serverUrl') as HTMLInputElement;\n  const defaultTone = document.getElementById('defaultTone') as HTMLSelectElement;\n  const redact = document.getElementById('redact') as HTMLInputElement;\n  const secret = document.getElementById('secret') as HTMLInputElement;\n  const installId = document.getElementById('installId') as HTMLInputElement;\n  const regen = document.getElementById('regen') as HTMLButtonElement;\n  const save = document.getElementById('save') as HTMLButtonElement;\n  const test = document.getElementById('test') as HTMLButtonElement;\n  const msg = document.getElementById('msg') as HTMLSpanElement;\n  const urlStatus = document.getElementById('urlStatus') as HTMLSpanElement;\n\n  const settings = await getSettings();\n  serverUrl.value = settings.serverUrl;\n  defaultTone.value = settings.defaultTone;\n  redact.checked = settings.redact;\n  secret.value = settings.secret || '';\n  installId.value = settings.installId;\n\n  function showUrlStatus() {\n    const ok = isValidUrl(serverUrl.value);\n    urlStatus.textContent = ok ? 'OK' : 'Error';\n    urlStatus.className = 'status ' + (ok ? 'ok' : 'err');\n  }\n  serverUrl.addEventListener('blur', showUrlStatus);\n  showUrlStatus();\n\n  regen.addEventListener('click', async () => {\n    const id = await regenerateInstallId();\n    installId.value = id;\n    await setLocalSettings({ installId: id });\n    msg.textContent = 'Install ID regenerated.';\n    setTimeout(() => (msg.textContent = ''), 1500);\n  });\n\n  save.addEventListener('click', async () => {\n    await setSyncSettings({ serverUrl: serverUrl.value, defaultTone: defaultTone.value as any, redact: redact.checked });\n    await setLocalSettings({ secret: secret.value });\n    msg.textContent = 'Saved.';\n    setTimeout(() => (msg.textContent = ''), 1200);\n  });\n\n  test.addEventListener('click', async () => {\n    msg.textContent = 'Pinging...';\n    try {\n      const res = await fetch(new URL('/healthz', serverUrl.value).toString());\n      const ok = res.ok && (await res.json()).ok === true;\n      msg.textContent = ok ? 'Server healthy.' : 'Server responded, but not OK.';\n    } catch (e) {\n      msg.textContent = 'Failed to connect.';\n    }\n  });\n}\n\ndocument.addEventListener('DOMContentLoaded', init);\n"],
  "mappings": "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",
  "names": []
}
