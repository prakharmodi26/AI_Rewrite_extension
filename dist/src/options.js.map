{
  "version": 3,
  "sources": ["../../extension/src/storage.ts", "../../extension/src/options.ts"],
  "sourcesContent": ["import { Settings, Tone, HistoryItem } from './types.js';\n\nconst DEFAULTS = {\n  serverUrl: 'http://localhost:8080',\n  defaultTone: 'friendly' as Tone,\n  redact: false,\n  dismissOnOutsideClick: true,\n};\n\nasync function ensureInstallId(): Promise<string> {\n  const { installId } = await chrome.storage.local.get('installId');\n  if (installId && typeof installId === 'string') return installId;\n  const id = crypto.randomUUID();\n  await chrome.storage.local.set({ installId: id });\n  return id;\n}\n\nexport async function getSettings(): Promise<Settings> {\n  const sync = await chrome.storage.sync.get(['serverUrl', 'defaultTone', 'redact', 'dismissOnOutsideClick']);\n  const local = await chrome.storage.local.get(['secret', 'installId']);\n  const installId = local.installId || (await ensureInstallId());\n  const allowedTones: Tone[] = ['friendly', 'formal', 'confident', 'persuasive', 'casual'];\n  const rawTone = (sync.defaultTone as string) || '';\n  const safeTone: Tone = allowedTones.includes(rawTone as Tone) ? (rawTone as Tone) : DEFAULTS.defaultTone;\n  return {\n    serverUrl: sync.serverUrl || DEFAULTS.serverUrl,\n    defaultTone: safeTone,\n    redact: typeof sync.redact === 'boolean' ? sync.redact : DEFAULTS.redact,\n    dismissOnOutsideClick: typeof sync.dismissOnOutsideClick === 'boolean' ? sync.dismissOnOutsideClick : DEFAULTS.dismissOnOutsideClick,\n    secret: typeof local.secret === 'string' ? local.secret : undefined,\n    installId,\n  };\n}\n\nexport async function setSyncSettings(partial: Partial<Pick<Settings, 'serverUrl' | 'defaultTone' | 'redact' | 'dismissOnOutsideClick'>>): Promise<void> {\n  await chrome.storage.sync.set(partial);\n}\n\nexport async function setLocalSettings(partial: Partial<Pick<Settings, 'secret' | 'installId'>>): Promise<void> {\n  await chrome.storage.local.set(partial);\n}\n\nexport async function regenerateInstallId(): Promise<string> {\n  const id = crypto.randomUUID();\n  await chrome.storage.local.set({ installId: id });\n  return id;\n}\n\nexport async function getHistory(): Promise<HistoryItem[]> {\n  const { history } = await chrome.storage.local.get('history');\n  if (Array.isArray(history)) return history as HistoryItem[];\n  return [];\n}\n\nexport async function addHistoryItem(item: Omit<HistoryItem, 'id' | 'ts'> & Partial<Pick<HistoryItem, 'id' | 'ts'>>): Promise<void> {\n  const current = await getHistory();\n  const full: HistoryItem = {\n    id: item.id || crypto.randomUUID(),\n    ts: item.ts || Date.now(),\n    task: item.task,\n    output: item.output,\n    inputPreview: item.inputPreview,\n    tone: item.tone,\n    percent: item.percent,\n    summary_level: item.summary_level,\n  };\n  const updated = [full, ...current].slice(0, 10);\n  await chrome.storage.local.set({ history: updated });\n}\n", "import { getSettings, regenerateInstallId, setLocalSettings, setSyncSettings } from './storage.js';\n\nfunction isValidUrl(value: string): boolean {\n  try {\n    const u = new URL(value);\n    return u.protocol === 'http:' || u.protocol === 'https:';\n  } catch {\n    return false;\n  }\n}\n\nasync function init() {\n  const serverUrl = document.getElementById('serverUrl') as HTMLInputElement;\n  const defaultTone = document.getElementById('defaultTone') as HTMLSelectElement;\n  const redact = document.getElementById('redact') as HTMLInputElement;\n  const dismissOnOutsideClick = document.getElementById('dismissOnOutsideClick') as HTMLInputElement;\n  const secret = document.getElementById('secret') as HTMLInputElement;\n  const installId = document.getElementById('installId') as HTMLInputElement;\n  const regen = document.getElementById('regen') as HTMLButtonElement;\n  const save = document.getElementById('save') as HTMLButtonElement;\n  const test = document.getElementById('test') as HTMLButtonElement;\n  const msg = document.getElementById('msg') as HTMLSpanElement;\n  const urlStatus = document.getElementById('urlStatus') as HTMLSpanElement;\n\n  const settings = await getSettings();\n  serverUrl.value = settings.serverUrl;\n  // If previous stored value is not in the new list, fall back to 'friendly'\n  const available = Array.from(defaultTone.options).map(o => o.value);\n  defaultTone.value = available.includes(settings.defaultTone) ? settings.defaultTone : 'friendly';\n  redact.checked = settings.redact;\n  dismissOnOutsideClick.checked = !!settings.dismissOnOutsideClick;\n  secret.value = settings.secret || '';\n  installId.value = settings.installId;\n\n  function showUrlStatus() {\n    const ok = isValidUrl(serverUrl.value);\n    urlStatus.textContent = ok ? 'OK' : 'Error';\n    urlStatus.className = 'status ' + (ok ? 'ok' : 'err');\n  }\n  serverUrl.addEventListener('blur', showUrlStatus);\n  showUrlStatus();\n\n  regen.addEventListener('click', async () => {\n    const id = await regenerateInstallId();\n    installId.value = id;\n    await setLocalSettings({ installId: id });\n    msg.textContent = 'Install ID regenerated.';\n    setTimeout(() => (msg.textContent = ''), 1500);\n  });\n\n  save.addEventListener('click', async () => {\n  await setSyncSettings({ serverUrl: serverUrl.value, defaultTone: defaultTone.value as any, redact: redact.checked, dismissOnOutsideClick: dismissOnOutsideClick.checked });\n    await setLocalSettings({ secret: secret.value });\n    msg.textContent = 'Saved.';\n    setTimeout(() => (msg.textContent = ''), 1200);\n  });\n\n  test.addEventListener('click', async () => {\n    msg.textContent = 'Pinging...';\n    try {\n      const res = await fetch(new URL('/healthz', serverUrl.value).toString());\n      const ok = res.ok && (await res.json()).ok === true;\n      msg.textContent = ok ? 'Server healthy.' : 'Server responded, but not OK.';\n    } catch (e) {\n      msg.textContent = 'Failed to connect.';\n    }\n  });\n}\n\ndocument.addEventListener('DOMContentLoaded', init);\n"],
  "mappings": "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",
  "names": []
}
